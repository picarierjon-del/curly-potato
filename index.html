<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Contabilità Pro – Mobile (Vue 3)</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Vue 3 -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <!-- Export PDF -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

  <style>
    :root{
      --bg:#0f1117; --panel:#171a22; --panel-2:#1b1f2b; --border:#23283a;
      --text:#e7eaf0; --muted:#9aa4b2; --accent:#6c7bff; --accent2:#35d9a3; --danger:#ff6b6b;
    }
    html,body{height:100%;}
    body{background:var(--bg); color:var(--text); font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;}
    .wrap{max-width:520px; margin:0 auto; min-height:100vh; display:flex; flex-direction:column;}
    .panel{background:var(--panel); border:1px solid var(--border); border-radius:16px;}
    .panel-2{background:var(--panel-2); border:1px solid var(--border); border-radius:16px;}
    .btn{background:var(--accent); color:white; padding:10px 14px; border-radius:12px; font-weight:700;}
    .btn-ghost{background:transparent; border:1px solid var(--border); color:#cfd5df; padding:10px 14px; border-radius:12px;}
    .chip{padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:#121625; font-size:12px;}
    .input, select, textarea{background:#0f1320; border:1px solid var(--border); color:var(--text); border-radius:12px; padding:10px 12px; width:100%;}
    .input:focus, select:focus, textarea:focus{outline:1px solid var(--accent);}
    .title-sm{color:var(--muted); font-size:12px;}
    .value-lg{font-size:26px; font-weight:800; letter-spacing:-0.2px;}
    .nav{position:sticky; bottom:0; left:0; right:0; background:rgba(15,17,23,.9); backdrop-filter:blur(8px); border-top:1px solid var(--border);}
    .navbtn{flex:1; text-align:center; padding:8px 0; font-size:13px; color:#a3aab7;}
    .navbtn.active{color:#aab3ff; font-weight:700;}
    .fabbar{position:fixed; bottom:72px; left:50%; transform:translateX(-50%); display:flex; gap:10px; z-index:40;}
    .fab{padding:12px 14px; border-radius:999px; color:white; font-weight:800; box-shadow:0 8px 24px rgba(0,0,0,.35);}
    .fab.in{background:#10b981;} .fab.out{background:#ef4444;}
    dialog::backdrop{background:rgba(0,0,0,.55);}
    .modal{width:min(560px,92vw); background:#0d1018; border:1px solid var(--border); border-radius:16px; color:var(--text);}
    .modal-h{padding:14px 16px; border-bottom:1px solid var(--border); font-weight:800;}
    .modal-b{padding:16px;}
    .modal-f{padding:16px; border-top:1px solid var(--border); display:flex; justify-content:flex-end; gap:10px;}
    .table th{color:#c4cad6; padding:10px 8px; font-weight:600; text-align:left; border-bottom:1px solid var(--border);}
    .table td{padding:10px 8px; border-bottom:1px solid #22273a;}
    .pill{padding:3px 8px; border-radius:999px; border:1px solid var(--border); font-size:11px; background:#121625;}
    .warn{border-color:#f59e0b; color:#fde68a; background:rgba(245,158,11,.15)}
    .danger{border-color:#ef4444; color:#fecaca; background:rgba(239,68,68,.15)}
    .ok{border-color:#22c55e; color:#bbf7d0; background:rgba(34,197,94,.15)}
  </style>
</head>
<body>
<div id="app" class="wrap">

  <!-- BANNER SCADENZE -->
  <div v-if="banner.items.length" class="panel mx-4 mt-3 p-3 flex items-start gap-3">
    <div class="text-xl">🔔</div>
    <div class="flex-1">
      <div class="font-semibold">Promemoria di oggi</div>
      <div class="text-sm text-[#cbd5e1]">
        <span v-if="banner.today.length">Oggi: {{ banner.today.map(e=>e.title).join(', ') }}.</span>
        <span v-if="banner.soon.length"> In arrivo (7gg): {{ banner.soon.map(e=>`${e.title} (${e.dday}g)`).join(', ') }}.</span>
        <span v-if="banner.overdue.length" class="text-rose-300"> Scaduti: {{ banner.overdue.map(e=>e.title).join(', ') }}!</span>
      </div>
    </div>
    <button class="btn-ghost" @click="dismissBannerToday">OK</button>
  </div>

  <!-- HEADER -->
  <header class="px-4 pt-4 pb-2 flex items-center justify-between">
    <div class="flex-1">
      <div class="text-xs text-[#9aa4b2] flex items-center gap-2">
        <span>{{ headerSubtitle }}</span>
        <!-- 🔎 Ricerca globale -->
        <div class="flex-1"></div>
      </div>
      <h1 class="text-xl font-extrabold tracking-tight">{{ headerTitle }}</h1>
    </div>
    <div class="flex gap-2">
      <button class="btn-ghost text-sm" @click="exportCSV">CSV</button>
      <button class="btn-ghost text-sm" @click="exportPDF">PDF</button>
    </div>
  </header>

  <!-- SEARCH BAR -->
  <div class="px-4">
    <input class="input w-full" v-model="q" placeholder="Cerca movimenti, clienti, fornitori, note…">
  </div>

  <!-- CONTENUTO -->
  <main class="flex-1 overflow-y-auto px-4 pb-28 space-y-4">

    <!-- HOME -->
    <section v-if="view==='home'">
      <!-- Categorie dinamiche -->
      <div class="title-sm mb-1">Categorie</div>
      <div class="flex flex-wrap gap-2">
        <button class="chip"
          :class="{'border-blue-400 text-blue-300': !filters.category}"
          @click="filters.category=null">Tutte</button>
        <button v-for="c in categories" :key="c" class="chip"
          :class="{'border-blue-400 text-blue-300': filters.category===c}"
          @click="filters.category = (filters.category===c?null:c)">
          {{ c }}
        </button>
      </div>

      <!-- KPI -->
      <div class="grid grid-cols-2 gap-3 mt-3">
        <div class="panel p-4 text-center">
          <div class="title-sm">Reddito (Entrate)</div>
          <div class="value-lg text-emerald-400">{{ fmtEUR(kpi.totEntrate) }}</div>
        </div>
        <div class="panel p-4 text-center">
          <div class="title-sm">Spese (Uscite)</div>
          <div class="value-lg text-rose-400">{{ fmtEUR(kpi.totSpese) }}</div>
        </div>
      </div>
      <div class="panel p-4 text-center">
        <div class="title-sm">Risparmi</div>
        <div class="value-lg text-amber-300">{{ fmtEUR(kpi.risparmi) }}</div>
      </div>

      <!-- Grafici -->
      <div class="panel p-3">
        <div class="title-sm mb-1">Entrate vs Uscite</div>
        <canvas id="chartHome" height="160"></canvas>
      </div>
      <div class="panel p-3">
        <div class="title-sm mb-1">Ripartizione per categoria</div>
        <canvas id="chartPie" height="180"></canvas>
      </div>

      <!-- Ultimi movimenti -->
      <div class="panel p-3">
        <div class="flex items-center justify-between mb-2">
          <div class="title-sm">Ultimi movimenti</div>
          <button class="btn-ghost text-xs" @click="switchView('summary')">Vedi tutto →</button>
        </div>
        <div v-for="r in lastRows" :key="r.id" class="flex items-center justify-between py-2 border-b border-[#23283a] last:border-0">
          <div>
            <div class="font-semibold text-sm">{{ r.Categoria || '—' }}</div>
            <div class="text-xs text-[#9aa4b2]">
              {{ r.Data }} • {{ r.Tipo }} •
              <span v-if="r.Tipo==='entrata' && r.Cliente">Cliente: {{ r.Cliente }}</span>
              <span v-if="r.Tipo==='spesa' && r.Fornitore">Forn.: {{ r.Fornitore }}</span>
            </div>
          </div>
          <div class="text-right">
            <div :class="r.Tipo==='entrata'?'text-emerald-400':'text-rose-400'">{{ fmtEUR(r.ImportoNetto || r.Importo) }}</div>
            <div class="text-[11px] text-[#9aa4b2]">IVA: {{ fmtEUR(r.ImportoIVA || 0) }}</div>
          </div>
        </div>
      </div>
    </section>

    <!-- RIEPILOGO -->
    <section v-if="view==='summary'">
      <!-- Filtri mese/anno + fornitore/cliente -->
      <div class="panel p-3">
        <div class="grid grid-cols-2 gap-2 mb-2">
          <select v-model="filters.year">
            <option v-for="y in years" :key="y" :value="y">{{ y }}</option>
          </select>
          <select v-model="filters.month">
            <option v-for="(m,i) in months" :key="m" :value="i">{{ m }}</option>
          </select>
        </div>
        <div class="grid grid-cols-2 gap-2">
          <select v-model="filters.partnerType">
            <option value="">Tutti i soggetti</option>
            <option value="cliente">Solo Clienti</option>
            <option value="fornitore">Solo Fornitori</option>
          </select>
          <input class="input" v-model="filters.partnerName" placeholder="Filtra per nome cliente/fornitore">
        </div>
      </div>

      <!-- KPI IVA -->
      <div class="grid grid-cols-2 gap-3 mt-3">
        <div class="panel p-3 text-center">
          <div class="title-sm">IVA a Debito</div>
          <div class="value-lg text-indigo-300">{{ fmtEUR(kpi.ivaDebito) }}</div>
        </div>
        <div class="panel p-3 text-center">
          <div class="title-sm">IVA a Credito</div>
          <div class="value-lg text-cyan-300">{{ fmtEUR(kpi.ivaCredito) }}</div>
        </div>
      </div>
      <div class="panel p-3 text-center">
        <div class="title-sm">IVA da Versare</div>
        <div class="value-lg text-amber-300">{{ fmtEUR(kpi.ivaDaVersare) }}</div>
      </div>

      <!-- Grafico annuale -->
      <div class="panel p-4">
        <div class="title-sm mb-1">Trend annuale</div>
        <canvas id="chartYear" height="200"></canvas>
      </div>

      <!-- Tabella -->
      <div class="panel p-3">
        <div class="flex items-center justify-between mb-2">
          <div class="title-sm">Movimenti mese</div>
          <div class="title-sm">{{ filteredRows.length }} righe</div>
        </div>
        <div class="overflow-x-auto">
          <table class="table w-full text-sm">
            <thead>
              <tr>
                <th>Data</th><th>Tipo</th><th>Lordo</th><th>IVA</th><th>Netto</th>
                <th>Categoria</th><th>Conto</th><th>Cliente/Fornitore</th><th>Note</th><th></th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="r in filteredRows" :key="r.id">
                <td>{{ r.Data }}</td>
                <td :class="r.Tipo==='entrata'?'text-emerald-300':'text-rose-300'">{{ r.Tipo }}</td>
                <td>{{ fmtEUR(r.Importo) }}</td>
                <td>{{ fmtEUR(r.ImportoIVA || 0) }} ({{ r.IVA }}%)</td>
                <td>{{ fmtEUR(r.ImportoNetto || r.Importo) }}</td>
                <td>{{ r.Categoria }}</td>
                <td>{{ r.Conto }}</td>
                <td>{{ r.Tipo==='entrata'? (r.Cliente||'—') : (r.Fornitore||'—') }}</td>
                <td class="truncate max-w-[140px]" :title="r.Note">{{ r.Note }}</td>
                <td class="text-right">
                  <button class="btn-ghost text-xs" @click="openEdit(r)">✏️</button>
                  <button class="btn-ghost text-xs" @click="removeRow(r.id)">🗑️</button>
                </td>
              </tr>
              <tr v-if="!filteredRows.length">
                <td colspan="10" class="text-center text-[#9aa4b2] py-4">Nessuna voce nel mese selezionato</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- SCADENZE -->
    <section v-if="view==='events'">
      <div class="flex items-center justify-between">
        <div class="title-sm">Scadenze & Promemoria</div>
        <button class="btn text-sm" @click="openEvent()">+ Nuova</button>
      </div>
      <div v-for="e in sortedEvents" :key="e.id" class="panel-2 p-3 mt-3 flex items-start justify-between">
        <div>
          <div class="font-semibold">{{ e.title }}</div>
          <div class="text-xs text-[#9aa4b2]">{{ e.date }} • {{ e.kind }} <span v-if="e.repeat">• 🔁 {{ repeatLabel(e.repeat) }}</span></div>
          <div class="mt-1">
            <span class="pill" :class="deadlineClass(e)">{{ deadlineLabel(e) }}</span>
            <span v-if="e.done" class="pill ok ml-2">Completato</span>
          </div>
          <div v-if="e.fileName" class="text-xs mt-1">
            📎 <a :href="e.fileData" :download="e.fileName" class="underline text-indigo-400">{{ e.fileName }}</a>
          </div>
        </div>
        <div class="flex gap-2">
          <button class="btn-ghost text-xs" @click="openEvent(e)">✏️</button>
          <button class="btn-ghost text-xs" @click="deleteEvent(e.id)">🗑️</button>
        </div>
      </div>
      <div v-if="!sortedEvents.length" class="text-center text-[#9aa4b2] text-sm mt-6">Nessuna scadenza</div>
    </section>

    <!-- RUBRICA (Clienti/Fornitori) -->
    <section v-if="view==='contacts'">
      <div class="panel p-3">
        <div class="flex items-center justify-between mb-2">
          <div class="title-sm">Rubrica</div>
          <button class="btn text-sm" @click="openContact()">+ Nuovo</button>
        </div>

        <!-- Tabs -->
        <div class="flex gap-2 mb-3">
          <button class="chip" :class="{'border-blue-400 text-blue-300': contactTab==='clients'}" @click="contactTab='clients'">Clienti</button>
          <button class="chip" :class="{'border-blue-400 text-blue-300': contactTab==='suppliers'}" @click="contactTab='suppliers'">Fornitori</button>
        </div>

        <!-- Search in Rubrica -->
        <input class="input mb-3" v-model="contactQuery" placeholder="Cerca per nome, P.IVA, note…">

        <!-- Lista -->
        <div v-for="c in filteredContacts" :key="c.id" class="panel-2 p-3 mb-2 flex items-start justify-between">
          <div>
            <div class="font-semibold">{{ c.nome }}</div>
            <div class="text-xs text-[#9aa4b2]">
              <span v-if="c.piva">P.IVA: {{ c.piva }} • </span>
              <span v-if="c.email">{{ c.email }} • </span>
              <span v-if="c.telefono">{{ c.telefono }}</span>
            </div>
            <div class="text-xs text-[#9aa4b2]" v-if="c.note">Note: {{ c.note }}</div>
          </div>
          <div class="flex gap-2">
            <button class="btn-ghost text-xs" @click="openContact(c)">✏️</button>
            <button class="btn-ghost text-xs" @click="deleteContact(c.id)">🗑️</button>
          </div>
        </div>
        <div v-if="!filteredContacts.length" class="text-center text-[#9aa4b2] text-sm mt-4">Nessun contatto</div>
      </div>
    </section>

    <!-- IMPOSTAZIONI -->
    <section v-if="view==='settings'">
      <div class="panel p-4 space-y-3">
        <label class="flex items-center gap-2">
          <input type="checkbox" v-model="settings.proactive"> <span>Modalità proattiva</span>
        </label>
        <div>
          <div class="title-sm mb-1">Budget spese (€)</div>
          <input type="number" class="input" v-model.number="settings.budgetSpese">
        </div>
        <div>
          <div class="title-sm mb-1">Soglia IVA (€)</div>
          <input type="number" class="input" v-model.number="settings.ivaThreshold">
        </div>

        <div class="flex flex-wrap gap-2 pt-2">
          <input type="file" accept=".csv" class="hidden" ref="csvInput" @change="importCSV">
          <button class="btn-ghost" @click="$refs.csvInput.click()">📂 Importa CSV</button>
          <button class="btn-ghost" @click="exportCSV">📤 Esporta CSV</button>
          <button class="btn-ghost" @click="exportPDF">📄 Esporta PDF</button>
          <button class="btn bg-rose-600 hover:bg-rose-500" @click="clearAll">🧹 Svuota tutto</button>
        </div>
      </div>
    </section>
  </main>

  <!-- FAB (Entrata/Uscita) -->
  <div class="fabbar">
    <button class="fab in"  @click="openTx('entrata')">+ Entrata</button>
    <button class="fab out" @click="openTx('spesa')">- Uscita</button>
  </div>

  <!-- NAV BOTTOM -->
  <nav class="nav px-2 pt-2 pb-[calc(env(safe-area-inset-bottom)+6px)] flex gap-1">
    <div class="navbtn" :class="{active:view==='home'}" @click="switchView('home')">🏠<br><span>Home</span></div>
    <div class="navbtn" :class="{active:view==='summary'}" @click="switchView('summary')">📊<br><span>Riepilogo</span></div>
    <div class="navbtn" :class="{active:view==='events'}" @click="switchView('events')">⏰<br><span>Scadenze</span></div>
    <div class="navbtn" :class="{active:view==='contacts'}" @click="switchView('contacts')">📇<br><span>Rubrica</span></div>
    <div class="navbtn" :class="{active:view==='settings'}" @click="switchView('settings')">⚙️<br><span>Impostazioni</span></div>
  </nav>

  <!-- MODALE: Movimenti (IVA + Cliente/Fornitore) -->
  <dialog ref="dlgTx" class="modal">
    <div class="modal-h">{{ txDraft.id ? 'Modifica movimento' : (txDraft.Tipo==='entrata' ? 'Nuova Entrata' : 'Nuova Uscita') }}</div>
    <div class="modal-b space-y-3">
      <div class="grid grid-cols-2 gap-2">
        <input type="date" class="input" v-model="txDraft.Data">
        <select class="input" v-model="txDraft.Tipo">
          <option value="entrata">Entrata</option>
          <option value="spesa">Uscita</option>
        </select>
      </div>

      <div class="grid grid-cols-2 gap-2">
        <div>
          <div class="title-sm mb-1">Importo lordo (€)</div>
          <input type="number" step="0.01" class="input" v-model.number="txDraft.Importo">
        </div>
        <div>
          <div class="title-sm mb-1">IVA % (rapida o personalizzata)</div>
          <div class="flex gap-2">
            <select class="input" v-model.number="presetIVA">
              <option :value="null">—</option>
              <option :value="0">0%</option>
              <option :value="4">4%</option>
              <option :value="5">5%</option>
              <option :value="10">10%</option>
              <option :value="22">22%</option>
            </select>
            <input type="number" step="0.1" class="input" v-model.number="txDraft.IVA" placeholder="IVA %">
          </div>
        </div>
      </div>

      <!-- Calcoli rapidi -->
      <div class="grid grid-cols-3 gap-2">
        <div class="panel-2 p-2 rounded-md text-center">
          <div class="text-[11px] text-[#9aa4b2]">Netto</div>
          <div class="font-bold">{{ fmtEUR(calcNetto(txDraft)) }}</div>
        </div>
        <div class="panel-2 p-2 rounded-md text-center">
          <div class="text-[11px] text-[#9aa4b2]">IVA</div>
          <div class="font-bold">{{ fmtEUR(calcIVA(txDraft)) }}</div>
        </div>
        <div class="panel-2 p-2 rounded-md text-center">
          <div class="text-[11px] text-[#9aa4b2]">{{ txDraft.Tipo==='entrata' ? 'IVA Debito' : 'IVA Credito' }}</div>
          <div class="font-bold">{{ fmtEUR(calcIVA(txDraft)) }}</div>
        </div>
      </div>

      <!-- Categoria (dipende dal tipo) -->
      <div class="grid grid-cols-2 gap-2">
        <select class="input" v-model="txDraft.Categoria">
          <option v-for="c in (txDraft.Tipo==='entrata'? categoriesIn : categoriesOut)" :key="c" :value="c">{{ c }}</option>
        </select>

        <!-- Cliente / Fornitore -->
        <div v-if="txDraft.Tipo==='entrata'">
          <input class="input" list="dlClients" v-model="txDraft.Cliente" placeholder="Cliente (seleziona o scrivi)">
          <datalist id="dlClients"><option v-for="c in clients" :key="c.id" :value="c.nome"></option></datalist>
        </div>
        <div v-else>
          <input class="input" list="dlSuppliers" v-model="txDraft.Fornitore" placeholder="Fornitore (seleziona o scrivi)">
          <datalist id="dlSuppliers"><option v-for="s in suppliers" :key="s.id" :value="s.nome"></option></datalist>
        </div>
      </div>

      <div class="grid grid-cols-2 gap-2">
        <input class="input" v-model="txDraft.Conto" placeholder="Conto (POS, Contanti, Banca...)">
        <input class="input" v-model="txDraft.Attivita" placeholder="Attività (Negozio, Online...)">
      </div>

      <textarea class="input" rows="2" v-model="txDraft.Note" placeholder="Note / Descrizione"></textarea>
    </div>
    <div class="modal-f">
      <button class="btn-ghost" @click="$refs.dlgTx.close()">Annulla</button>
      <button class="btn" @click="saveTx">Salva</button>
    </div>
  </dialog>

  <!-- MODALE: Scadenza -->
  <dialog ref="dlgEvent" class="modal">
    <div class="modal-h">{{ eventDraft.id ? 'Modifica scadenza' : 'Nuova scadenza' }}</div>
    <div class="modal-b space-y-3">
      <input class="input" v-model="eventDraft.title" placeholder="Titolo (es. IVA 4° trim / Assicurazione auto)">
      <input type="date" class="input" v-model="eventDraft.date">
      <select class="input" v-model="eventDraft.kind">
        <option>Fiscale</option><option>Assicurazione</option><option>Bolletta</option><option>Compleanno</option><option>Altro</option>
      </select>
      <select class="input" v-model="eventDraft.repeat">
        <option value="">Nessuna ricorrenza</option>
        <option value="month">Mensile</option>
        <option value="quarter">Trimestrale</option>
        <option value="year">Annuale</option>
      </select>
      <label class="flex items-center gap-2 text-sm">
        <input type="checkbox" v-model="eventDraft.done"> Completato
      </label>
      <input type="file" @change="attachFile($event)">
      <div v-if="eventDraft.fileName" class="text-xs">
        📎 <a :href="eventDraft.fileData" :download="eventDraft.fileName" class="underline text-indigo-400">{{ eventDraft.fileName }}</a>
      </div>
    </div>
    <div class="modal-f">
      <button class="btn-ghost" @click="$refs.dlgEvent.close()">Annulla</button>
      <button class="btn" @click="saveEvent">Salva</button>
    </div>
  </dialog>

  <!-- MODALE: Contatto (Cliente/Fornitore) -->
  <dialog ref="dlgContact" class="modal">
    <div class="modal-h">{{ contactDraft.id ? 'Modifica contatto' : 'Nuovo contatto' }}</div>
    <div class="modal-b space-y-3">
      <div class="grid grid-cols-2 gap-2">
        <select class="input" v-model="contactDraft.tipo">
          <option value="cliente">Cliente</option>
          <option value="fornitore">Fornitore</option>
        </select>
        <input class="input" v-model="contactDraft.nome" placeholder="Nome / Ragione sociale">
      </div>
      <div class="grid grid-cols-2 gap-2">
        <input class="input" v-model="contactDraft.piva" placeholder="P.IVA / CF (opz.)">
        <input class="input" v-model="contactDraft.email" placeholder="Email (opz.)">
      </div>
      <div class="grid grid-cols-2 gap-2">
        <input class="input" v-model="contactDraft.telefono" placeholder="Telefono (opz.)">
        <input class="input" v-model="contactDraft.pagamento" placeholder="Pagamento preferito (opz.)">
      </div>
      <textarea class="input" rows="2" v-model="contactDraft.note" placeholder="Note (opz.)"></textarea>
    </div>
    <div class="modal-f">
      <button class="btn-ghost" @click="$refs.dlgContact.close()">Annulla</button>
      <button class="btn" @click="saveContact">Salva</button>
    </div>
  </dialog><!-- CryptoJS per cifratura AES -->
<script src="https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/crypto-js.min.js"></script>

<script>
const { createApp } = Vue;

createApp({
  data() {
    const now = new Date();
    return {
      // UI / Stato base
      view: 'home',
      months: ['Gennaio','Febbraio','Marzo','Aprile','Maggio','Giugno','Luglio','Agosto','Settembre','Ottobre','Novembre','Dicembre'],
      filters: {
        category: null,
        month: now.getMonth(),
        year: now.getFullYear(),
        partnerType: '',       // '', 'cliente', 'fornitore'
        partnerName: ''        // filtro per nome cliente/fornitore
      },
      q: '', // ricerca globale top-bar

      // Dati principali
      rows: [],          // movimenti
      events: [],        // scadenze
      clients: [],       // rubrica clienti
      suppliers: [],     // rubrica fornitori

      // Impostazioni (salvate in chiaro tranne il PIN hash)
      settings: {
        proactive: true,
        budgetSpese: 0,
        ivaThreshold: 0,
        pinEnabled: false,  // se true, richiede PIN e cifra i dati
      },
      pinHash: '',         // SHA256(PIN) salvato in localStorage
      _sessionKey: '',     // chiave di sessione derivata dal PIN inserito (non salvata)

      // Modali / Draft
      txDraft: {},
      eventDraft: {},
      contactDraft: {},
      contactTab: 'clients', // 'clients' | 'suppliers'
      contactQuery: '',
      presetIVA: null,

      // Banner scadenze
      banner: { items:[], today:[], soon:[], overdue:[] },
      charts: {}, // cache istanze Chart.js

      // categorie veloci per tipo
      categoriesIn:  ['Fatture clienti','Corrispettivi','Servizi','Vendite online','Altro'],
      categoriesOut: ['Acquisti fornitori','Servizi','Affitto','Utenze','Marketing','Varie'],
    }
  },

  computed: {
    headerTitle() {
      return this.view==='home'?'Dashboard':this.view==='summary'?'Riepilogo':this.view==='events'?'Scadenze':this.view==='contacts'?'Rubrica':'Impostazioni';
    },
    headerSubtitle(){ return `${this.months[this.filters.month]} ${this.filters.year}`; },
    years(){ const y=new Date().getFullYear(); return [y-1,y,y+1]; },

    // categorie dinamiche da movimenti
    categories(){
      const set = new Set(this.rows.map(r => r.Categoria).filter(Boolean));
      // ordina per frequenza
      const freq = {};
      this.rows.forEach(r => { if (r.Categoria) freq[r.Categoria]=(freq[r.Categoria]||0)+1; });
      return [...set].sort((a,b)=>(freq[b]||0)-(freq[a]||0));
    },

    // filtro principale per tabella riepilogo
    filteredRows(){
      const m=this.filters.month, y=this.filters.year;
      const cat=this.filters.category;
      const pType=this.filters.partnerType, pName=(this.filters.partnerName||'').toLowerCase();
      const q=(this.q||'').toLowerCase();

      return this.rows.filter(r=>{
        const d=new Date(r.Data+'T00:00:00');
        if (d.getMonth()!==m || d.getFullYear()!==y) return false;
        if (cat && r.Categoria!==cat) return false;

        // filtro partner
        if (pType==='cliente' && r.Tipo!=='entrata') return false;
        if (pType==='cliente' && pName && !(r.Cliente||'').toLowerCase().includes(pName)) return false;
        if (pType==='fornitore' && r.Tipo!=='spesa') return false;
        if (pType==='fornitore' && pName && !(r.Fornitore||'').toLowerCase().includes(pName)) return false;

        // ricerca globale (categoria, note, cliente/fornitore, conto)
        if (q) {
          const hay = [
            r.Categoria||'', r.Note||'', r.Conto||'', r.Attivita||'',
            r.Cliente||'', r.Fornitore||'', r.Tipo||''
          ].join(' ').toLowerCase();
          if (!hay.includes(q)) return false;
        }
        return true;
      });
    },

    // ultimi 5 movimenti (per Home)
    lastRows(){ return this.rows.slice(-5).reverse(); },

    // KPI (netti + iva)
    kpi(){
      let entr=0, sp=0, ivaDeb=0, ivaCred=0;
      this.filteredRows.forEach(r=>{
        const iva = this.calcIVA(r);
        const netto = this.calcNetto(r);
        if (r.Tipo==='entrata'){ entr+=netto; ivaDeb+=iva; }
        else { sp+=netto; ivaCred+=iva; }
      });
      return {
        totEntrate: entr,
        totSpese:   sp,
        risparmi:   entr - sp,
        ivaDebito:  ivaDeb,
        ivaCredito: ivaCred,
        ivaDaVersare: ivaDeb - ivaCred
      };
    },

    // Rubrica filtrata
    filteredContacts(){
      const q=(this.contactQuery||'').toLowerCase();
      const list = this.contactTab==='clients' ? this.clients : this.suppliers;
      if (!q) return list;
      return list.filter(c=>{
        return [c.nome,c.piva,c.email,c.telefono,c.note].filter(Boolean).join(' ').toLowerCase().includes(q);
      });
    }
  },

  watch:{
    // Cambi IVA predefinita nel popup movimento
    presetIVA(v){ if(v!=null) this.txDraft.IVA=v; },

    // Persistenza automatica (con cifratura se attiva)
    rows: { deep:true, handler(){ this.secureSaveAll(); this.refreshCharts(); } },
    events:{ deep:true, handler(){ this.secureSaveAll(); this.computeBanner(); } },
    clients:{deep:true, handler(){ this.secureSaveAll(); } },
    suppliers:{deep:true, handler(){ this.secureSaveAll(); } },
    settings:{deep:true, handler(){ this.saveSettings(); } },

    // Ricalcolo grafici quando cambiano i filtri
    filters: { deep:true, handler(){ this.refreshCharts(); } },
    q(){ this.refreshCharts(); }
  },

  mounted(){
    // Carica impostazioni + (se necessario) sblocco con PIN e caricamento dati cifrati
    this.loadSettings();
    this.secureLoadAll().then(()=>{
      // se non ci sono dati, carica demo
      if (!this.rows.length) this.loadDemo();
      this.refreshCharts();
      this.computeBanner();
    });
  },

  methods:{
    // ------------------ Utils base ------------------
    fmtEUR(v){ return (Number(v)||0).toLocaleString('it-IT',{style:'currency',currency:'EUR'}); },
    uid(){ return Math.random().toString(36).slice(2)+Date.now().toString(36); },
    switchView(v){ this.view=v; setTimeout(this.refreshCharts,200); },

    // ------------------ IVA & calcoli ------------------
    calcIVA(r){ const perc = Number(r.IVA)||0; const lordo = Number(r.Importo)||0; return +(lordo * perc / 100).toFixed(2); },
    calcNetto(r){ const lordo = Number(r.Importo)||0; return +(lordo - this.calcIVA(r)).toFixed(2); },

    // ------------------ Movimenti ------------------
    openTx(tipo){
      this.txDraft = {
        id:null, Tipo:tipo, Data: new Date().toISOString().slice(0,10),
        Importo: 0, IVA: 22,
        Categoria: (tipo==='entrata'? this.categoriesIn[0] : this.categoriesOut[0]),
        Conto:'', Attivita:'', Note:'',
        Cliente:'', Fornitore:''
      };
      this.presetIVA = null;
      this.$refs.dlgTx.showModal();
    },
    openEdit(r){ this.txDraft = JSON.parse(JSON.stringify(r)); this.presetIVA=null; this.$refs.dlgTx.showModal(); },
    saveTx(){
      const r = JSON.parse(JSON.stringify(this.txDraft));
      if (!r.Data || !r.Tipo || !r.Importo) { alert('Compila data, tipo e importo'); return; }
      r.Importo = +r.Importo;
      r.ImportoIVA = this.calcIVA(r);
      r.ImportoNetto = this.calcNetto(r);

      // se entrata -> usa Cliente; se spesa -> usa Fornitore
      if (r.Tipo==='entrata') { r.Fornitore=''; }
      else { r.Cliente=''; }

      if (!r.id) r.id=this.uid();
      const idx = this.rows.findIndex(x=>x.id===r.id);
      if (idx>=0) this.rows.splice(idx,1,r); else this.rows.push(r);

      this.$refs.dlgTx.close();
    },
    removeRow(id){ if (confirm('Eliminare movimento?')) this.rows = this.rows.filter(r=>r.id!==id); },

    // ------------------ CSV / PDF ------------------
    exportCSV(){
      const header = ['id','Data','Tipo','Importo','IVA','ImportoIVA','ImportoNetto','Categoria','Conto','Attivita','Cliente','Fornitore','Note'];
      const body = this.rows.map(r=>header.map(k=> (r[k]??'')).join(';')).join('\n');
      const blob = new Blob([header.join(';')+'\n'+body],{type:'text/csv;charset=utf-8;'});
      const url=URL.createObjectURL(blob); const a=document.createElement('a');
      a.href=url; a.download='contabilita_pro.csv'; a.click();
    },
    importCSV(ev){
      const file=ev.target.files?.[0]; if(!file) return;
      const reader=new FileReader();
      reader.onload=()=>{
        const lines=String(reader.result).split('\n').filter(Boolean);
        const keys=lines[0].split(';');
        this.rows = lines.slice(1).map(l=>{
          const vals=l.split(';'); const o={}; keys.forEach((k,i)=>o[k]=vals[i]);
          o.Importo=+o.Importo||0; o.IVA=+o.IVA||0; o.ImportoIVA=+o.ImportoIVA||0; o.ImportoNetto=+o.ImportoNetto||0;
          return o;
        });
      };
      reader.readAsText(file);
    },
    exportPDF(){
      const target = document.querySelector('main');
      html2canvas(target,{backgroundColor:null,scale:2}).then(canvas=>{
        const pdf = new jspdf.jsPDF('p','mm','a4');
        const img = canvas.toDataURL('image/png');
        const w = 210; const h = canvas.height * w / canvas.width;
        pdf.addImage(img,'PNG',0,0,w,h); pdf.save('report-pro.pdf');
      });
    },
    clearAll(){
      if (!confirm('Sicuro di svuotare TUTTO (movimenti, scadenze, rubrica, impostazioni)?')) return;
      localStorage.clear(); location.reload();
    },

    // ------------------ Scadenze ------------------
    openEvent(e=null){
      this.eventDraft = e ? JSON.parse(JSON.stringify(e)) : {
        id:null, title:'', date:new Date().toISOString().slice(0,10),
        kind:'Altro', repeat:'', done:false, fileName:'', fileData:''
      };
      this.$refs.dlgEvent.showModal();
    },
    saveEvent(){
      const e = JSON.parse(JSON.stringify(this.eventDraft));
      if (!e.title || !e.date) { alert('Titolo e data obbligatori'); return; }
      if (!e.id) e.id=this.uid();
      const idx = this.events.findIndex(x=>x.id===e.id);
      if (idx>=0) this.events.splice(idx,1,e); else this.events.push(e);

      // ricorrenza: se completata, crea la prossima
      if (e.done && e.repeat) {
        const d = new Date(e.date+'T00:00:00');
        if (e.repeat==='month') d.setMonth(d.getMonth()+1);
        if (e.repeat==='quarter') d.setMonth(d.getMonth()+3);
        if (e.repeat==='year') d.setFullYear(d.getFullYear()+1);
        this.events.push({ ...e, id:this.uid(), date:d.toISOString().slice(0,10), done:false });
      }
      this.$refs.dlgEvent.close();
    },
    deleteEvent(id){ if (confirm('Eliminare scadenza?')) this.events = this.events.filter(x=>x.id!==id); },
    attachFile(ev){
      const f=ev.target.files?.[0]; if(!f) return;
      const reader=new FileReader();
      reader.onload=()=>{ this.eventDraft.fileData=reader.result; this.eventDraft.fileName=f.name; };
      reader.readAsDataURL(f);
    },
    repeatLabel(v){ return v==='month'?'Mensile':v==='quarter'?'Trimestrale':v==='year'?'Annuale':'—'; },
    deadlineClass(e){
      const dd=this.daysDiff(e.date);
      return dd<0?'danger': dd<=7?'warn':'ok';
    },
    deadlineLabel(e){
      const dd=this.daysDiff(e.date);
      return dd<0?`Scaduto ${Math.abs(dd)}g fa`: dd===0?'Oggi': `Tra ${dd}g`;
    },
    daysDiff(d){ const t=new Date(d+'T00:00:00'); const n=new Date(new Date().toISOString().slice(0,10)+'T00:00:00'); return Math.floor((t-n)/86400000); },

    // Banner scadenze (giornaliero)
    computeBanner(){
      const today=[], soon=[], overdue=[];
      this.events.forEach(e=>{
        if (e.done) return;
        const dd=this.daysDiff(e.date);
        if (dd===0) today.push({...e,dday:0});
        else if (dd>0 && dd<=7) soon.push({...e,dday:dd});
        else if (dd<0) overdue.push({...e,dday:dd});
      });
      const items=[...today,...soon,...overdue];
      const lastSeen=localStorage.getItem('pro_banner_seen_on');
      const todayS=new Date().toISOString().slice(0,10);
      this.banner = (items.length && lastSeen!==todayS) ? {items,today,soon,overdue} : {items:[],today:[],soon:[],overdue:[]};
    },
    dismissBannerToday(){ localStorage.setItem('pro_banner_seen_on', new Date().toISOString().slice(0,10)); this.banner={items:[],today:[],soon:[],overdue:[]}; },

    // ------------------ Rubrica ------------------
    openContact(c=null){
      this.contactDraft = c ? JSON.parse(JSON.stringify(c)) : {
        id:null, tipo:'cliente', nome:'', piva:'', email:'', telefono:'', pagamento:'', note:''
      };
      this.$refs.dlgContact.showModal();
    },
    saveContact(){
      const c = JSON.parse(JSON.stringify(this.contactDraft));
      if (!c.nome) { alert('Inserisci il nome'); return; }
      if (!c.id) c.id=this.uid();

      if (c.tipo==='cliente') {
        const idx=this.clients.findIndex(x=>x.id===c.id);
        if (idx>=0) this.clients.splice(idx,1,c); else this.clients.push(c);
      } else {
        const idx=this.suppliers.findIndex(x=>x.id===c.id);
        if (idx>=0) this.suppliers.splice(idx,1,c); else this.suppliers.push(c);
      }
      this.$refs.dlgContact.close();
    },
    deleteContact(id){
      if (!confirm('Eliminare contatto?')) return;
      this.clients = this.clients.filter(c=>c.id!==id);
      this.suppliers = this.suppliers.filter(c=>c.id!==id);
    },

    // ------------------ Grafici ------------------
    refreshCharts(){
      setTimeout(()=>{
        // Home bar Entrate vs Uscite
        const ctx1=document.getElementById('chartHome');
        if (ctx1){
          const e=this.filteredRows.filter(r=>r.Tipo==='entrata').reduce((s,r)=>s+this.calcNetto(r),0);
          const u=this.filteredRows.filter(r=>r.Tipo==='spesa').reduce((s,r)=>s+this.calcNetto(r),0);
          this.makeBar(ctx1,['Entrate','Uscite'],[e,u],['#10b981','#ef4444']);
        }

        // Pie categorie (saldo netto per categoria)
        const ctx2=document.getElementById('chartPie');
        if (ctx2){
          const map={};
          this.filteredRows.forEach(r=>{
            const k=r.Categoria||'Altro';
            const val=this.calcNetto(r)*(r.Tipo==='entrata'?1:-1);
            map[k]=(map[k]||0)+val;
          });
          const labels=Object.keys(map), data=Object.values(map);
          this.makePie(ctx2,labels,data);
        }

        // Trend annuale (per mese)
        const ctx3=document.getElementById('chartYear');
        if (ctx3){
          const arr=Array(12).fill(0);
          this.rows.forEach(r=>{
            const d=new Date(r.Data+'T00:00:00');
            if (d.getFullYear()===this.filters.year){
              arr[d.getMonth()] += this.calcNetto(r)*(r.Tipo==='entrata'?1:-1);
            }
          });
          this.makeLine(ctx3,this.months,arr);
        }
      }, 150);
    },
    destroyChart(ctx){ if(this.charts[ctx.id]){ this.charts[ctx.id].destroy(); delete this.charts[ctx.id]; } },
    makeBar(ctx,labels,data,colors){
      this.destroyChart(ctx);
      this.charts[ctx.id]=new Chart(ctx,{type:'bar',data:{labels,datasets:[{data,backgroundColor:colors}]},options:{plugins:{legend:{display:false}}}});
    },
    makePie(ctx,labels,data){
      this.destroyChart(ctx);
      const palette=['#6c7bff','#35d9a3','#fbbf24','#ef4444','#14b8a6','#818cf8','#22d3ee','#fde047'];
      this.charts[ctx.id]=new Chart(ctx,{type:'doughnut',data:{labels,datasets:[{data,backgroundColor:palette}]},options:{plugins:{legend:{labels:{color:'#e5e7eb'}}}}});
    },
    makeLine(ctx,labels,data){
      this.destroyChart(ctx);
      this.charts[ctx.id]=new Chart(ctx,{type:'line',data:{labels,datasets:[{data,fill:true,borderColor:'#6c7bff',backgroundColor:'rgba(108,123,255,.22)',tension:.35}]},options:{plugins:{legend:{display:false}},scales:{x:{ticks:{color:'#cbd5e1'}},y:{ticks:{color:'#cbd5e1'}}}}});
    },

    // ------------------ Settings + Sicurezza ------------------
    saveSettings(){
      // NON salviamo il PIN in chiaro. Solo pinEnabled e soglie.
      localStorage.setItem('pro_settings', JSON.stringify({ ...this.settings }));
      // Salvataggio dati (si occuperà la secureSaveAll)
      this.secureSaveAll();
    },
    loadSettings(){
      try {
        const st = JSON.parse(localStorage.getItem('pro_settings')||'{}');
        Object.assign(this.settings, st||{});
        this.pinHash = localStorage.getItem('pro_pin_hash') || '';
      } catch {}
    },

    async secureLoadAll(){
      // Se il PIN non è abilitato, carica in chiaro
      if (!this.settings.pinEnabled || !this.pinHash) {
        try {
          this.rows = JSON.parse(localStorage.getItem('pro_rows')||'[]');
          this.events = JSON.parse(localStorage.getItem('pro_events')||'[]');
          this.clients= JSON.parse(localStorage.getItem('pro_clients')||'[]');
          this.suppliers=JSON.parse(localStorage.getItem('pro_suppliers')||'[]');
        } catch{}
        return;
      }

      // Con PIN: chiedi PIN e decifra
      let ok=false;
      while(!ok){
        const pin = prompt('🔒 Inserisci PIN per sbloccare i dati');
        if (pin===null){ alert('Dati bloccati. Impostazioni → disattiva PIN o reinserisci.'); break; }
        const key = CryptoJS.SHA256(pin).toString();
        try {
          const dec = (k)=> {
            const enc = localStorage.getItem(k);
            if (!enc) return '[]';
            const bytes = CryptoJS.AES.decrypt(enc, key);
            const txt = bytes.toString(CryptoJS.enc.Utf8);
            if (!txt) throw new Error('PIN errato');
            return txt;
          };
          this.rows = JSON.parse(dec('pro_rows_enc'));
          this.events= JSON.parse(dec('pro_events_enc'));
          this.clients=JSON.parse(dec('pro_clients_enc'));
          this.suppliers=JSON.parse(dec('pro_suppliers_enc'));
          this._sessionKey = key; ok=true;
        } catch (e) {
          alert('PIN errato. Riprova.');
        }
      }
    },

    secureSaveAll(){
      // se cifratura disattiva → salva in chiaro
      if (!this.settings.pinEnabled || !this.pinHash || !this._sessionKey) {
        localStorage.setItem('pro_rows', JSON.stringify(this.rows));
        localStorage.setItem('pro_events', JSON.stringify(this.events));
        localStorage.setItem('pro_clients', JSON.stringify(this.clients));
        localStorage.setItem('pro_suppliers', JSON.stringify(this.suppliers));
        return;
      }
      // cifrato
      const enc = (k,obj)=> localStorage.setItem(k, CryptoJS.AES.encrypt(JSON.stringify(obj), this._sessionKey).toString());
      enc('pro_rows_enc', this.rows);
      enc('pro_events_enc', this.events);
      enc('pro_clients_enc', this.clients);
      enc('pro_suppliers_enc', this.suppliers);
      // rimuovi eventuali copie in chiaro
      localStorage.removeItem('pro_rows');
      localStorage.removeItem('pro_events');
      localStorage.removeItem('pro_clients');
      localStorage.removeItem('pro_suppliers');
    },

    // Utility per impostare/aggiornare PIN (da Impostazioni: abilita/disabilita manualmente modificando settings.pinEnabled e ricarica)
    setNewPIN(){
      const pin1 = prompt('Imposta nuovo PIN (min 4 cifre)');
      if (!pin1 || pin1.length<4) return alert('PIN troppo corto');
      const pin2 = prompt('Ripeti PIN');
      if (pin1!==pin2) return alert('I PIN non coincidono');
      const hash = CryptoJS.SHA256(pin1).toString();
      localStorage.setItem('pro_pin_hash', hash);
      this.pinHash = hash;
      this._sessionKey = CryptoJS.SHA256(pin1).toString();
      this.settings.pinEnabled = true;
      this.saveSettings();
      this.secureSaveAll();
      alert('PIN impostato e dati cifrati.');
    },
    disablePIN(){
      if (!confirm('Disattivare il PIN e salvare i dati in chiaro su questo dispositivo?')) return;
      this.settings.pinEnabled=false;
      this._sessionKey='';
      this.saveSettings();
      // Salva in chiaro
      this.secureSaveAll();
      alert('PIN disattivato. Dati ora salvati in chiaro su questo dispositivo.');
    },

    // ------------------ Banner / Demo ------------------
    daysInMonth(y,m){ return new Date(y, m+1, 0).getDate(); },
    loadDemo(){
      // movimenti demo
      const d = (y,m,day)=> `${y}-${String(m+1).padStart(2,'0')}-${String(day).padStart(2,'0')}`;
      const y=this.filters.year, m=this.filters.month;
      this.rows = [
        { id:this.uid(), Data:d(y,m,2),  Tipo:'entrata', Importo:2300, IVA:22, ImportoIVA:506, ImportoNetto:1794, Categoria:'Fatture clienti', Conto:'POS', Attivita:'Negozio', Cliente:'Cliente A', Fornitore:'', Note:'Vendita mensile' },
        { id:this.uid(), Data:d(y,m,4),  Tipo:'entrata', Importo:1900, IVA:10, ImportoIVA:190, ImportoNetto:1710, Categoria:'Corrispettivi', Conto:'Contanti', Attivita:'Negozio', Cliente:'Cliente B', Fornitore:'', Note:'Cassa' },
        { id:this.uid(), Data:d(y,m,6),  Tipo:'spesa',   Importo:1280, IVA:22, ImportoIVA:282, ImportoNetto:998,  Categoria:'Affitto', Conto:'Banca', Attivita:'Sede', Cliente:'', Fornitore:'Proprietario', Note:'Canone' },
        { id:this.uid(), Data:d(y,m,7),  Tipo:'spesa',   Importo:560,  IVA:10, ImportoIVA:56,  ImportoNetto:504,  Categoria:'Utenze', Conto:'Banca', Attivita:'Sede', Cliente:'', Fornitore:'Enel', Note:'Energia' },
        { id:this.uid(), Data:d(y,m,8),  Tipo:'spesa',   Importo:2300, IVA:22, ImportoIVA:506, ImportoNetto:1794, Categoria:'Marketing', Conto:'Online', Attivita:'Promo', Cliente:'', Fornitore:'Meta Ads', Note:'Campagna' }
      ];
      // rubrica demo
      this.clients = [
        { id:this.uid(), tipo:'cliente', nome:'Cliente A', piva:'IT12345678901', email:'a@clienti.it', telefono:'', pagamento:'Bonifico', note:'' },
        { id:this.uid(), tipo:'cliente', nome:'Cliente B', piva:'', email:'b@clienti.it', telefono:'', pagamento:'Carta', note:'' }
      ];
      this.suppliers = [
        { id:this.uid(), tipo:'fornitore', nome:'Proprietario', piva:'', email:'', telefono:'', pagamento:'Bonifico', note:'Affitto' },
        { id:this.uid(), tipo:'fornitore', nome:'Enel', piva:'', email:'', telefono:'', pagamento:'RID', note:'Utenze' },
        { id:this.uid(), tipo:'fornitore', nome:'Meta Ads', piva:'', email:'', telefono:'', pagamento:'Carta', note:'Marketing' }
      ];
      // scadenze demo
      this.events = [
        { id:this.uid(), title:'IVA 3° trim', date:d(y,m,16), kind:'Fiscale', repeat:'quarter', done:false, fileName:'', fileData:'' },
        { id:this.uid(), title:'Assicurazione', date:d(y,m,20), kind:'Assicurazione', repeat:'year', done:false, fileName:'', fileData:'' }
      ];
    }
  }
}).mount('#app');
</script>
</body>
</html>
