<!DOCTYPE html>
<html lang="it" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>COMMANDER V8 - SEAL EDITION</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&family=Plus+Jakarta+Sans:wght@300;400;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #020617; color: #f8fafc; overflow-x: hidden; }
        .glass-card { background: rgba(15, 23, 42, 0.9); border: 1px solid rgba(51, 65, 85, 0.5); border-radius: 24px; box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5); }
        .input-commander { background: #070b14; border: 1px solid #1e293b; color: #fff; border-radius: 14px; padding: 12px; width: 100%; outline: none; font-weight: 700; transition: all 0.2s; }
        .input-commander:focus { border-color: #3b82f6; box-shadow: 0 0 10px rgba(59, 130, 246, 0.3); }
        .tab-btn { flex: 1; padding: 12px 5px; font-size: 9px; font-weight: 800; border-radius: 14px; color: #64748b; text-transform: uppercase; letter-spacing: 1px; }
        .tab-btn.active { background: #3b82f6; color: white; box-shadow: 0 4px 20px rgba(59, 130, 246, 0.5); }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .scanline { width: 100%; height: 2px; background: rgba(59, 130, 246, 0.1); position: absolute; top: 0; animation: scan 4s linear infinite; pointer-events: none; }
        @keyframes scan { from { top: 0; } to { top: 100%; } }
        .glow-text { text-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
        .hidden { display: none !important; }
        @media print { .no-print { display: none !important; } #printArea { color: black; background: white; } }
    </style>
</head>
<body class="pb-56">
    <div class="scanline"></div>

    <div id="authScreen" class="fixed inset-0 z-[10000] bg-[#020617] flex items-center justify-center p-6">
        <div class="text-center space-y-8 p-10 glass-card w-full max-w-sm border-t-4 border-blue-600">
            <div class="flex flex-col items-center">
                <div class="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mb-4 shadow-[0_0_20px_#3b82f6]">
                    <span class="text-3xl">üî±</span>
                </div>
                <h1 class="text-3xl font-black italic text-white uppercase tracking-tighter">Commander <span class="text-blue-500">Seal</span></h1>
                <p class="text-[9px] text-slate-500 font-bold tracking-[0.3em] uppercase mt-2">Restricted Access</p>
            </div>
            <input type="password" id="pinInput" class="input-commander text-4xl text-center tracking-[0.5em]" placeholder="****" maxlength="4">
            <button onclick="checkAuth()" class="w-full bg-blue-600 py-5 rounded-2xl font-black hover:bg-blue-500 transition-all uppercase text-sm tracking-widest">Inizia Operazione</button>
        </div>
    </div>

    <div id="mainUI" class="hidden">
        <nav class="sticky top-0 z-50 bg-[#020617]/95 border-b border-slate-800 p-4 backdrop-blur-xl">
            <div class="flex justify-between items-center max-w-4xl mx-auto">
                <div>
                    <div class="flex items-center gap-2">
                        <span id="opStatus" class="text-[9px] font-black text-blue-500 uppercase tracking-tighter">UNIT√Ä ATTIVA</span>
                        <div class="w-1.5 h-1.5 rounded-full bg-blue-500 animate-ping"></div>
                    </div>
                    <p id="topDate" class="text-[10px] font-bold text-slate-400 uppercase mono"></p>
                </div>
                <div class="flex gap-2">
                    <button onclick="shareWhatsApp()" class="bg-green-600/10 text-green-500 px-4 py-2 rounded-xl border border-green-500/30 font-black text-[10px] uppercase">WhatsApp</button>
                    <button onclick="window.print()" class="bg-slate-800 text-slate-300 px-4 py-2 rounded-xl border border-slate-700 font-black text-[10px] uppercase">Print</button>
                </div>
            </div>
        </nav>

        <div class="p-4 space-y-4 max-w-4xl mx-auto">
            <div class="glass-card p-6 border-l-4 border-blue-500 relative overflow-hidden">
                <div class="flex justify-between items-start mb-2">
                    <div>
                        <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest">Liquidit√† in Cassetta</p>
                        <h3 id="walletToDeposit" class="text-5xl font-black text-white mono glow-text italic">‚Ç¨ 0</h3>
                    </div>
                    <div class="text-right">
                        <p id="forecastTag" class="text-[9px] font-black bg-blue-500/20 text-blue-400 px-2 py-1 rounded-lg uppercase">Analisi: In attesa...</p>
                        <p id="deadlineAlert" class="hidden text-red-500 text-[9px] font-black mt-2 animate-bounce uppercase">‚ö†Ô∏è SCADENZA RILEVATA</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-4 mt-8 pt-6 border-t border-slate-800/50">
                    <div>
                        <p class="text-[9px] font-bold text-slate-500 uppercase italic">Netto Odierno</p>
                        <p id="netCashDisplay" class="text-2xl font-black text-green-400 mono">‚Ç¨ 0.00</p>
                    </div>
                    <div class="text-right">
                        <p class="text-[9px] font-bold text-slate-500 uppercase italic">Settimana (L-D)</p>
                        <p id="weeklyCash" class="text-2xl font-black text-white mono">‚Ç¨ 0</p>
                    </div>
                </div>
            </div>

            <div class="flex gap-1 p-1.5 bg-slate-900/50 rounded-2xl border border-slate-800">
                <button onclick="showTab('day')" id="btn-day" class="tab-btn active italic">Tactical</button>
                <button onclick="showTab('bank')" id="btn-bank" class="tab-btn italic">Banca</button>
                <button onclick="showTab('deadlines')" id="btn-deadlines" class="tab-btn italic">Scadenze</button>
                <button onclick="showTab('config')" id="btn-config" class="tab-btn italic text-blue-400">Settings</button>
            </div>

            <div id="sec-day" class="space-y-4">
                <div class="glass-card p-6">
                    <div class="flex gap-2 mb-8 no-print justify-center">
                        <button onclick="changeDate(-1)" class="bg-slate-800 w-12 h-12 rounded-xl flex items-center justify-center font-bold text-blue-500 hover:bg-slate-700 transition">‚óÄ</button>
                        <input type="date" id="datePicker" class="input-commander text-center text-xs flex-1 border-none bg-slate-800/50" onchange="setDateFromPicker()">
                        <button onclick="changeDate(1)" class="bg-slate-800 w-12 h-12 rounded-xl flex items-center justify-center font-bold text-blue-500 hover:bg-slate-700 transition">‚ñ∂</button>
                    </div>
                    
                    <div class="text-center">
                        <p class="text-[10px] font-black text-blue-500 uppercase tracking-[0.4em] mb-2 italic">Ingresso Fiscale (Z)</p>
                        <input type="number" id="total_sales" class="bg-transparent text-7xl font-black text-white w-full text-center outline-none mono mb-4" placeholder="0.00" oninput="runLogic()">
                        
                        <div class="w-full h-2 bg-slate-800 rounded-full overflow-hidden mb-8 border border-slate-700">
                            <div id="missionProgress" class="h-full bg-blue-600 transition-all duration-500" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-[9px] font-black text-slate-500 uppercase ml-1">Clienti Serviti</label>
                            <input type="number" id="n_clients" placeholder="0" class="input-commander text-center text-xl" oninput="runLogic()">
                        </div>
                        <div>
                            <label class="text-[9px] font-black text-slate-500 uppercase ml-1">Acconti Ricevuti</label>
                            <input type="number" id="acconti" placeholder="‚Ç¨ 0" class="input-commander text-center text-xl" oninput="runLogic()">
                        </div>
                    </div>
                </div>

                <div class="glass-card p-6">
                    <h4 class="text-[10px] font-black text-slate-400 uppercase mb-6 tracking-widest flex items-center gap-2">
                        <span>üí≥</span> Metodi Elettronici
                    </h4>
                    <div id="digitalInputs" class="grid grid-cols-2 gap-4"></div>
                </div>

                <div class="glass-card p-6 border-l-4 border-red-900">
                    <h4 class="text-[10px] font-black text-red-500 uppercase mb-6 tracking-widest flex items-center gap-2">
                        <span>üì¶</span> Logistica Uscite (Cash)
                    </h4>
                    <div id="supList" class="space-y-3"></div>
                </div>
            </div>

            <div id="sec-bank" class="hidden space-y-4">
                <div class="glass-card p-6 border-t-4 border-green-600 bg-gradient-to-b from-green-900/10 to-transparent">
                    <h3 class="text-xs font-black text-green-500 uppercase mb-6 italic">Extraction Mode (Versamenti)</h3>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <input type="date" id="searchFrom" class="input-commander text-xs">
                        <input type="date" id="searchTo" class="input-commander text-xs">
                    </div>
                    <button onclick="calculatePeriod()" class="w-full bg-slate-800 py-4 rounded-xl font-black text-[10px] uppercase tracking-widest hover:bg-slate-700 transition">1. Scansiona Periodo</button>
                    
                    <div id="resultPeriod" class="mt-6 p-6 bg-black/40 rounded-3xl border border-green-900/30 hidden text-center animate-pulse">
                        <p class="text-[10px] text-green-500 uppercase font-black mb-2">Totale Pronto per il Versamento</p>
                        <h2 id="periodCashResult" class="text-5xl font-black text-white mono mb-6">‚Ç¨ 0.00</h2>
                        <button onclick="confirmDeposit()" class="w-full bg-green-600 py-5 rounded-2xl font-black text-xs uppercase shadow-[0_0_20px_rgba(22,163,74,0.4)]">2. Conferma Versamento</button>
                    </div>
                </div>

                <div class="glass-card overflow-hidden">
                    <div class="p-4 bg-slate-900/50 border-b border-slate-800">
                        <p class="text-[10px] font-black uppercase tracking-widest">Storico Operazioni</p>
                    </div>
                    <table class="w-full text-[11px] text-left">
                        <thead class="bg-slate-900 text-slate-500 uppercase font-bold">
                            <tr><th class="p-4">Data</th><th class="p-4">Cash</th><th class="p-4 text-right">Status</th></tr>
                        </thead>
                        <tbody id="accountingTableBody"></tbody>
                    </table>
                </div>
            </div>

            <div id="sec-config" class="hidden space-y-4">
                <div class="glass-card p-6">
                    <h3 class="text-xs font-black text-blue-500 uppercase mb-6 italic">Configurazione Flussi</h3>
                    <div class="space-y-4">
                        <div class="p-4 bg-slate-900/50 rounded-2xl border border-slate-800">
                            <p class="text-[10px] font-bold text-slate-500 mb-2 uppercase">Nuovo Metodo Digitale</p>
                            <div class="flex gap-2">
                                <input type="text" id="newDigitalName" class="input-commander text-xs" placeholder="Nome">
                                <input type="number" id="newDigitalFee" class="input-commander text-xs w-20" placeholder="%">
                                <button onclick="addDigitalMethod()" class="bg-blue-600 px-4 rounded-xl font-bold">+</button>
                            </div>
                            <div id="digitalMethodsList" class="mt-4 space-y-1"></div>
                        </div>

                        <div class="p-4 bg-slate-900/50 rounded-2xl border border-slate-800">
                            <p class="text-[10px] font-bold text-slate-500 mb-2 uppercase">Fornitore Recurrente</p>
                            <div class="flex gap-2">
                                <input type="text" id="newSupName" class="input-commander text-xs" placeholder="Nome">
                                <button onclick="addSupplier()" class="bg-blue-600 px-4 rounded-xl font-bold">+</button>
                            </div>
                            <div id="supConfigList" class="mt-4 space-y-1"></div>
                        </div>
                    </div>
                </div>
                
                <div class="glass-card p-6 bg-black border border-slate-800">
                    <h3 class="text-[10px] font-black text-slate-500 uppercase mb-4 mono italic">System Log</h3>
                    <div id="terminalLog" class="h-32 overflow-y-auto text-[10px] mono text-blue-400 space-y-1">
                        <div>[SYSTEM] Inizializzazione protocollo Commander...</div>
                    </div>
                </div>
            </div>

            <div id="sec-deadlines" class="hidden space-y-4">
                <div class="glass-card p-6">
                    <h3 class="text-xs font-black text-orange-500 uppercase mb-6 italic">Pianificazione Scadenze</h3>
                    <div class="flex gap-2 mb-6">
                        <input type="text" id="deadName" class="input-commander text-xs flex-1" placeholder="Nome">
                        <input type="number" id="deadDay" class="input-commander text-xs w-16" placeholder="GG">
                        <input type="number" id="deadAmt" class="input-commander text-xs w-24" placeholder="Importo ‚Ç¨">
                        <button onclick="addDeadline()" class="bg-orange-600 px-5 rounded-xl font-black">+</button>
                    </div>
                    <div id="deadlineList" class="space-y-2"></div>
                </div>
            </div>
        </div>

        <div class="fixed bottom-0 left-0 right-0 p-6 bg-[#020617]/95 border-t border-slate-800 backdrop-blur-xl z-[100] no-print">
            <div class="max-w-4xl mx-auto flex justify-between items-center">
                <div>
                    <p class="text-[9px] font-black text-slate-500 uppercase tracking-tighter mb-1">Cassa Reale Attuale</p>
                    <div id="theoCash" class="text-4xl font-black text-white mono italic glow-text">‚Ç¨ 0.00</div>
                </div>
                <button onclick="saveData()" class="bg-blue-600 text-white font-black px-12 py-5 rounded-3xl shadow-[0_0_30px_rgba(59,130,246,0.5)] uppercase text-xs tracking-widest hover:scale-105 active:scale-95 transition-all">Archivia Operazione</button>
            </div>
        </div>
    </div>

    <script>
        let activeDate = new Date();
        const pin = "1234";
        let suppliers = JSON.parse(localStorage.getItem('om_suppliers_v8')) || ["Pane", "Beverage", "Utenze"];
        let digitalMethods = JSON.parse(localStorage.getItem('om_digital_v8')) || [{name:"POS", fee:1.2}, {name:"Satispay", fee:0.5}];
        let deadlines = JSON.parse(localStorage.getItem('om_deadlines_v8')) || [];

        function checkAuth() {
            if(document.getElementById('pinInput').value === pin) {
                document.getElementById('authScreen').classList.add('hidden');
                document.getElementById('mainUI').classList.remove('hidden');
                addLog("ACCESSO AUTORIZZATO. COMANDANTE ONLINE.");
                init();
            } else { alert("ACCESSO NEGATO."); }
        }

        function init() {
            updateDateUI(); loadSettings(); renderSuppliers(); renderDigitalInputs();
            renderDeadlines(); loadDateData(); updateSetupLists(); checkTodayDeadlines();
        }

        function addLog(msg) {
            const log = document.getElementById('terminalLog');
            const time = new Date().toLocaleTimeString();
            log.innerHTML += `<div>[${time}] - ${msg}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        function playBeep(freq = 440, type = 'sine') {
            const context = new (window.AudioContext || window.webkitAudioContext)();
            const osc = context.createOscillator();
            const gain = context.createGain();
            osc.type = type; osc.frequency.setValueAtTime(freq, context.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.00001, context.currentTime + 0.3);
            osc.connect(gain); gain.connect(context.destination);
            osc.start(); osc.stop(context.currentTime + 0.3);
        }

        function runLogic() {
            const total = parseFloat(document.getElementById('total_sales').value) || 0;
            const target = 1000; // Impostabile in futuro nel setup
            const progress = Math.min((total / target) * 100, 100);
            
            document.getElementById('missionProgress').style.width = progress + "%";
            const status = document.getElementById('opStatus');
            if(total > target) {
                status.innerText = "OBIETTIVO COMPLETATO";
                status.className = "text-[9px] font-black text-green-500 animate-pulse uppercase";
            } else if(total > 0) {
                status.innerText = "MISSIONE IN CORSO";
                status.className = "text-[9px] font-black text-blue-500 uppercase";
            }

            let totalDig = 0;
            document.querySelectorAll('.dig-amt').forEach(el => totalDig += parseFloat(el.value) || 0);
            let cashExp = 0;
            document.querySelectorAll('.sup-amt').forEach((el, i) => { if(document.querySelectorAll('.sup-check')[i].checked) cashExp += parseFloat(el.value) || 0; });

            const netCash = (total - totalDig - cashExp) + (parseFloat(document.getElementById('acconti').value) || 0);
            document.getElementById('theoCash').innerText = `‚Ç¨ ${netCash.toFixed(2)}`;
            document.getElementById('netCashDisplay').innerText = `‚Ç¨ ${netCash.toFixed(2)}`;
            
            calculateGlobalCash();
            calculateForecasting(total);
        }

        function calculateGlobalCash() {
            let totalWallet = 0; let weekly = 0;
            for (let i = 0; i < localStorage.length; i++){
                let key = localStorage.key(i);
                if(key.startsWith('om_v8_')) {
                    let d = JSON.parse(localStorage.getItem(key));
                    if(!d.isVersato) {
                        let dig = d.digitalVals.reduce((a,b)=>parseFloat(a||0)+parseFloat(b||0),0);
                        let exp = d.supAmts.reduce((acc, v, idx) => acc + (d.supChecks[idx] ? parseFloat(v||0) : 0), 0);
                        totalWallet += (parseFloat(d.total)||0) - dig - exp + (parseFloat(d.acconti)||0);
                    }
                }
            }
            document.getElementById('walletToDeposit').innerText = `‚Ç¨ ${totalWallet.toFixed(0)}`;
            for(let i=0; i<7; i++){
                let d = new Date(); d.setDate(d.getDate()-i);
                let data = JSON.parse(localStorage.getItem('om_v8_'+d.toISOString().split('T')[0]));
                if(data){
                    let dig = data.digitalVals.reduce((a,b)=>parseFloat(a||0)+parseFloat(b||0),0);
                    let exp = data.supAmts.reduce((acc, v, idx) => acc + (data.supChecks[idx] ? parseFloat(v||0) : 0), 0);
                    weekly += (parseFloat(data.total)||0) - dig - exp + (parseFloat(data.acconti)||0);
                }
            }
            document.getElementById('weeklyCash').innerText = `‚Ç¨ ${weekly.toFixed(0)}`;
        }

        function calculateForecasting(curr) {
            let tot = 0; let c = 0; const m = activeDate.getMonth();
            for(let i=1; i<=31; i++){
                let v = JSON.parse(localStorage.getItem('om_v8_'+`${activeDate.getFullYear()}-${String(m+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`));
                if(v) { tot += parseFloat(v.total); c++; }
            }
            let avg = c > 0 ? (tot/c) : curr;
            document.getElementById('forecastTag').innerText = `STIMA MESE: ‚Ç¨ ${(avg*30).toFixed(0)}`;
        }

        function saveData() {
            const key = 'om_v8_' + activeDate.toISOString().split('T')[0];
            const old = JSON.parse(localStorage.getItem(key)) || {};
            const data = {
                total: document.getElementById('total_sales').value,
                acconti: document.getElementById('acconti').value,
                digitalVals: Array.from(document.querySelectorAll('.dig-amt')).map(e => e.value),
                supAmts: Array.from(document.querySelectorAll('.sup-amt')).map(e => e.value),
                supChecks: Array.from(document.querySelectorAll('.sup-check')).map(e => e.checked),
                isVersato: old.isVersato || false
            };
            localStorage.setItem(key, JSON.stringify(data));
            playBeep(880);
            addLog(`DATABASE AGGIORNATO: ${activeDate.toLocaleDateString()}`);
            alert("PROTOCOLLO DI ARCHIVIAZIONE COMPLETATO.");
            runLogic();
        }

        // Recupero funzioni integrate precedenti
        function loadDateData() {
            const key = 'om_v8_' + activeDate.toISOString().split('T')[0];
            const s = JSON.parse(localStorage.getItem(key));
            document.querySelectorAll('input[type="number"]').forEach(i => { if(!['tax_rate','fixed_costs'].includes(i.id)) i.value = ""; });
            document.querySelectorAll('.sup-check').forEach(c => c.checked = false);
            if(s) {
                document.getElementById('total_sales').value = s.total;
                document.getElementById('acconti').value = s.acconti || "";
                s.digitalVals?.forEach((v, i) => { if(document.querySelectorAll('.dig-amt')[i]) document.querySelectorAll('.dig-amt')[i].value = v; });
                s.supAmts?.forEach((v, i) => { if(document.querySelectorAll('.sup-amt')[i]) document.querySelectorAll('.sup-amt')[i].value = v; });
                s.supChecks?.forEach((v, i) => { if(document.querySelectorAll('.sup-check')[i]) document.querySelectorAll('.sup-check')[i].checked = v; });
            }
            runLogic();
        }

        function calculatePeriod() {
            const from = document.getElementById('searchFrom').value;
            const to = document.getElementById('searchTo').value;
            if(!from || !to) return;
            let periodTotal = 0;
            let start = new Date(from); let end = new Date(to);
            for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                let data = JSON.parse(localStorage.getItem('om_v8_' + d.toISOString().split('T')[0]));
                if(data && !data.isVersato) {
                    let dig = data.digitalVals.reduce((a,b)=>parseFloat(a||0)+parseFloat(b||0), 0);
                    let exp = data.supAmts.reduce((acc, v, idx) => acc + (data.supChecks[idx] ? parseFloat(v||0) : 0), 0);
                    periodTotal += (parseFloat(data.total)||0) - dig - exp + (parseFloat(data.acconti)||0);
                }
            }
            document.getElementById('resultPeriod').classList.remove('hidden');
            document.getElementById('periodCashResult').innerText = `‚Ç¨ ${periodTotal.toFixed(2)}`;
            addLog(`SCANSIONE PERIODO COMPLETATA: ‚Ç¨ ${periodTotal.toFixed(2)}`);
        }

        function confirmDeposit() {
            if(!confirm("CONFERMI TRASFERIMENTO FONDI IN BANCA?")) return;
            let start = new Date(document.getElementById('searchFrom').value); let end = new Date(document.getElementById('searchTo').value);
            for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
                let k = 'om_v8_' + d.toISOString().split('T')[0];
                let data = JSON.parse(localStorage.getItem(k));
                if(data) { data.isVersato = true; localStorage.setItem(k, JSON.stringify(data)); }
            }
            addLog("VERSAMENTO BANCA REGISTRATO.");
            location.reload();
        }

        function showTab(t) { 
            ['day','bank','deadlines','config'].forEach(s => {document.getElementById('sec-'+s).classList.add('hidden'); document.getElementById('btn-'+s).classList.remove('active');}); 
            document.getElementById('sec-'+t).classList.remove('hidden'); document.getElementById('btn-'+t).classList.add('active'); 
            playBeep(220, 'square');
            if(t==='bank') updateAccountingTable(); 
        }

        function updateAccountingTable() {
            const body = document.getElementById('accountingTableBody'); body.innerHTML = "";
            const m = activeDate.getMonth();
            for(let i=31; i>=1; i--) {
                const k = `${activeDate.getFullYear()}-${String(m+1).padStart(2,'0')}-${String(i).padStart(2,'0')}`;
                const d = JSON.parse(localStorage.getItem('om_v8_' + k));
                if(d) {
                    let dig = d.digitalVals.reduce((a,b)=>parseFloat(a||0)+parseFloat(b||0),0);
                    let exp = d.supAmts.reduce((acc, v, idx) => acc + (d.supChecks[idx] ? parseFloat(v||0) : 0), 0);
                    let cash = (parseFloat(d.total)||0) - dig - exp + (parseFloat(d.acconti)||0);
                    body.innerHTML += `<tr class="border-b border-slate-800/50"><td class="p-4 mono">${i}/${m+1}</td><td class="p-4 text-green-400 font-bold">‚Ç¨ ${cash.toFixed(0)}</td><td class="p-4 text-right">${d.isVersato ? 'üî±' : '‚è≥'}</td></tr>`;
                }
            }
        }

        function loadSettings() { ['fixed_costs', 'tax_rate'].forEach(k => { if(localStorage.getItem('set_'+k)) document.getElementById(k).value = localStorage.getItem('set_'+k); }); }
        function renderDigitalInputs() { document.getElementById('digitalInputs').innerHTML = digitalMethods.map(m => `<div class="space-y-1"><label class="text-[8px] text-slate-500 uppercase font-black">${m.name}</label><input type="number" class="dig-amt input-commander text-sm" data-fee="${m.fee}" oninput="runLogic()"></div>`).join(''); }
        function renderSuppliers() { document.getElementById('supList').innerHTML = suppliers.map(s => `<div class="flex items-center gap-3 bg-slate-800/20 p-4 rounded-2xl border border-slate-800/50 hover:border-blue-500/50 transition"><span class="text-[10px] font-black text-slate-400 flex-1 uppercase">${s}</span><input type="number" class="sup-amt bg-transparent text-right text-sm font-black text-white w-20 outline-none" placeholder="0.00" oninput="runLogic()"><input type="checkbox" class="sup-check w-6 h-6 accent-blue-600 rounded" onchange="runLogic()"></div>`).join(''); }
        function addDigitalMethod() { const n = document.getElementById('newDigitalName').value; const f = document.getElementById('newDigitalFee').value; if(n && f) { digitalMethods.push({name: n, fee: parseFloat(f)}); localStorage.setItem('om_digital_v8', JSON.stringify(digitalMethods)); location.reload(); } }
        function addSupplier() { const n = document.getElementById('newSupName').value; if(n) { suppliers.push(n); localStorage.setItem('om_suppliers_v8', JSON.stringify(suppliers)); location.reload(); } }
        function updateSetupLists() {
            document.getElementById('digitalMethodsList').innerHTML = digitalMethods.map((m,i)=>`<div class="flex justify-between p-3 bg-slate-900 border border-slate-800 rounded-xl mb-1 text-[10px]"><span>${m.name}</span><button onclick="digitalMethods.splice(${i},1);localStorage.setItem('om_digital_v8',JSON.stringify(digitalMethods));location.reload();" class="text-red-500 font-bold">ELIMINA</button></div>`).join('');
            document.getElementById('supConfigList').innerHTML = suppliers.map((s,i)=>`<div class="flex justify-between p-3 bg-slate-900 border border-slate-800 rounded-xl mb-1 text-[10px]"><span>${s.toUpperCase()}</span><button onclick="suppliers.splice(${i},1);localStorage.setItem('om_suppliers_v8',JSON.stringify(suppliers));location.reload();" class="text-red-500 font-bold">ELIMINA</button></div>`).join('');
        }
        function addDeadline() { deadlines.push({name:document.getElementById('deadName').value, day:document.getElementById('deadDay').value, amt:document.getElementById('deadAmt').value}); localStorage.setItem('om_deadlines_v8', JSON.stringify(deadlines)); renderDeadlines(); addLog("SCADENZA AGGIUNTA."); }
        function renderDeadlines() { document.getElementById('deadlineList').innerHTML = deadlines.map((d,i)=>`<div class="flex justify-between bg-slate-900 p-3 border border-slate-800 rounded-xl text-[10px]"><span>GG ${d.day} - ${d.name} (‚Ç¨${d.amt})</span><button onclick="deadlines.splice(${i},1);localStorage.setItem('om_deadlines_v8', JSON.stringify(deadlines));renderDeadlines();" class="text-red-500 font-bold">X</button></div>`).join(''); }
        function checkTodayDeadlines() { const d = deadlines.find(x => parseInt(x.day) === activeDate.getDate()); if(d) document.getElementById('deadlineAlert').classList.remove('hidden'); else document.getElementById('deadlineAlert').classList.add('hidden'); }
        function updateDateUI() { document.getElementById('datePicker').value = activeDate.toISOString().split('T')[0]; document.getElementById('topDate').innerText = activeDate.toLocaleDateString('it-IT', { weekday:'long', day:'numeric', month:'long' }); }
        function changeDate(v) { activeDate.setDate(activeDate.getDate()+v); updateDateUI(); loadDateData(); checkTodayDeadlines(); }
        function setDateFromPicker() { activeDate = new Date(document.getElementById('datePicker').value); updateDateUI(); loadDateData(); checkTodayDeadlines(); }
        function shareWhatsApp() { const t = `*COMMANDER SEAL REPORT*\nüìÖ ${document.getElementById('topDate').innerText}\nüíµ Cash Oggi: ${document.getElementById('netCashDisplay').innerText}\nüè¶ Totale In Cassa: ${document.getElementById('walletToDeposit').innerText}`; window.open(`https://wa.me/?text=${encodeURIComponent(t)}`); }
        function backupAndReset() { if(confirm("CANCELLARE TUTTO? OPERAZIONE IRREVERSIBILE.")) { localStorage.clear(); location.reload(); } }
    </script>
</body>
</html>
