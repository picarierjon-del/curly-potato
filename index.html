<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ErjonPro Business Gold</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #2563eb; --success: #10b981; --danger: #ef4444; }
        body { background-color: #f8fafc; font-family: 'Inter', sans-serif; }
        .page { display: none; padding-bottom: 100px; }
        .active-page { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .card { background: white; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); padding: 1.25rem; margin-bottom: 1rem; }
        input[type="number"], input[type="text"], input[type="password"], input[type="date"], select { 
            width: 100%; border: 1px solid #cbd5e1; border-radius: 10px; padding: 12px; font-size: 16px; 
        }
        .nav-bottom { position: fixed; bottom: 0; width: 100%; background: white; border-top: 1px solid #e2e8f0; display: flex; justify-content: space-around; padding: 10px 0; z-index: 1000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #94a3b8; font-size: 10px; font-weight: bold; }
        .nav-item.active { color: var(--primary); }
        #lock-screen { position: fixed; inset: 0; background: #1e293b; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
        @media print { .no-print { display: none !important; } .page { display: block !important; } }
    </style>
</head>
<body>

    <div id="lock-screen">
        <h1 class="text-3xl font-black mb-8 text-blue-400">ERJON PRO</h1>
        <div class="w-64">
            <p class="text-center mb-4 text-slate-400 uppercase text-xs tracking-widest">Inserire PIN di Accesso</p>
            <input type="password" id="pin-input" class="text-center text-2xl tracking-[1em] text-slate-900 mb-4" maxlength="4" placeholder="****">
            <button onclick="checkPin()" class="w-full bg-blue-600 py-4 rounded-xl font-bold active:scale-95 transition">ACCEDI</button>
            <p id="pin-error" class="text-red-400 text-sm mt-4 text-center hidden">PIN Errato. Riprova.</p>
        </div>
    </div>

    <header class="bg-white border-b sticky top-0 z-50 p-4 no-print flex justify-between items-center">
        <h1 class="font-black text-blue-600 italic">ERJON<span class="text-slate-800">PRO</span></h1>
        <button onclick="lockApp()" class="text-slate-400"><i class="fa-solid fa-lock"></i></button>
    </header>

    <main class="max-w-md mx-auto p-4">

        <section id="page-oggi" class="page active-page">
            <div class="card bg-blue-50 border-blue-100 flex items-center justify-between">
                <input type="date" id="data-lavoro" class="bg-transparent border-none font-bold text-blue-700">
                <i class="fa-solid fa-calendar-day text-blue-300"></i>
            </div>

            <div class="card">
                <h3 class="font-bold text-slate-800 mb-4 border-b pb-2">Entrate Giornaliere</h3>
                <div class="space-y-3">
                    <div><label class="text-[10px] font-bold text-slate-400">CORRISPETTIVI TOTALI</label>
                    <input type="number" id="inp-tot" placeholder="0.00" class="text-xl font-black" oninput="calcola()"></div>
                    <div class="grid grid-cols-2 gap-2">
                        <input type="number" class="val-elettr" id="inp-pos" placeholder="Bancomat" oninput="calcola()">
                        <input type="number" class="val-elettr" id="inp-sat" placeholder="Satispay" oninput="calcola()">
                        <input type="number" class="val-elettr" id="inp-del" placeholder="Delivery" oninput="calcola()">
                        <input type="number" class="val-elettr" id="inp-tap" placeholder="Tap/App" oninput="calcola()">
                    </div>
                </div>
            </div>

            <div class="card border-l-4 border-red-500">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold">Uscite Fornitori</h3>
                    <button onclick="addFornitore()" class="text-blue-600 font-bold text-xs">+ AGGIUNGI</button>
                </div>
                <div id="fornitori-list" class="space-y-2">
                    </div>
            </div>

            <div class="card bg-slate-900 text-white">
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between text-slate-400"><span>Elettronici Totali:</span> <span id="res-elettr">€ 0.00</span></div>
                    <div class="flex justify-between text-slate-400"><span>Contanti Teorici:</span> <span id="res-teor">€ 0.00</span></div>
                    <div class="flex justify-between text-orange-400 font-bold border-b border-slate-700 pb-2"><span>Pagati Cash (Spunta):</span> <span id="res-cash-uscita">€ 0.00</span></div>
                    <div class="flex justify-between text-xl font-black text-green-400 pt-1"><span>NETTO DA VERSARE:</span> <span id="res-netto">€ 0.00</span></div>
                </div>
                <button onclick="salvaTutto()" class="w-full mt-4 bg-blue-600 py-3 rounded-xl font-bold">SALVA GIORNATA</button>
            </div>
        </section>

        <section id="page-riepilogo" class="page">
            <div class="flex justify-between items-center mb-4">
                <h2 class="font-bold text-lg">Statistiche</h2>
                <input type="month" id="filter-month" onchange="updateStats()" class="w-auto p-1 text-sm">
            </div>
            
            <div class="grid grid-cols-2 gap-3 mb-4">
                <div class="card text-center"><p class="text-[10px] text-slate-400">Mese Corrente</p><p id="stat-month" class="text-lg font-bold">€ 0</p></div>
                <div class="card text-center"><p class="text-[10px] text-slate-400">Uscite Mese</p><p id="stat-usc" class="text-lg font-bold text-red-500">€ 0</p></div>
            </div>

            <div class="card">
                <h3 class="font-bold text-sm mb-3">Ricerca Storica Giorno</h3>
                <div class="flex gap-2">
                    <input type="date" id="search-date">
                    <button onclick="cercaGiorno()" class="bg-slate-800 text-white px-4 rounded-lg"><i class="fa-solid fa-search"></i></button>
                </div>
                <div id="search-result" class="mt-4 hidden p-3 bg-slate-50 rounded-lg text-sm"></div>
            </div>
        </section>

        <section id="page-stampa" class="page">
            <div class="card">
                <h3 class="font-bold mb-4">Esporta Dati Commercialista</h3>
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-2">
                        <input type="date" id="p-from">
                        <input type="date" id="p-to">
                    </div>
                    <select id="p-mode">
                        [span_2](start_span)<option value="tutto">Report Completo[span_2](end_span)</option>
                        <option value="solo-corr">Solo Corrispettivi Z</option>
                        <option value="solo-ele">Solo Pagamenti Elettronici</option>
                    </select>
                    <button onclick="generaReportRagioniere()" class="w-full bg-slate-800 text-white py-3 rounded-lg font-bold">GENERA DOCUMENTO</button>
                </div>
            </div>
            <div id="area-stampa" class="mt-4"></div>
        </section>

    </main>

    <nav class="nav-bottom no-print">
        <button onclick="showPage('oggi')" class="nav-item active" id="btn-oggi"><i class="fa-solid fa-plus-circle text-xl"></i>Oggi</button>
        <button onclick="showPage('riepilogo')" class="nav-item" id="btn-riepilogo"><i class="fa-solid fa-chart-line text-xl"></i>Riepilogo</button>
        <button onclick="showPage('stampa')" class="nav-item" id="btn-stampa"><i class="fa-solid fa-file-invoice text-xl"></i>Stampa</button>
    </nav>

    <script>
        const PIN_CORRETTO = "1234"; // Imposta qui il tuo PIN professionale
        let database = JSON.parse(localStorage.getItem('erjon_pro_db') || '[]');

        function checkPin() {
            if(document.getElementById('pin-input').value === PIN_CORRETTO) {
                document.getElementById('lock-screen').style.display = 'none';
            } else {
                document.getElementById('pin-error').classList.remove('hidden');
            }
        }

        function lockApp() { location.reload(); }

        function showPage(p) {
            document.querySelectorAll('.page').forEach(el => el.classList.remove('active-page'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById('page-'+p).classList.add('active-page');
            document.getElementById('btn-'+p).classList.add('active');
            if(p === 'riepilogo') updateStats();
        }

        function addFornitore() {
            const container = document.getElementById('fornitori-list');
            const div = document.createElement('div');
            div.className = "flex items-center gap-2 bg-slate-50 p-2 rounded-lg";
            div.innerHTML = `
                <input type="text" placeholder="Fornitore" class="flex-1 !p-1 text-sm">
                <input type="number" placeholder="€" class="w-20 !p-1 text-sm val-usc" oninput="calcola()">
                <div class="flex flex-col items-center">
                    <span class="text-[8px] font-bold">CASH?</span>
                    <input type="checkbox" class="check-cash w-5 h-5" onchange="calcola()">
                </div>
                <button onclick="this.parentElement.remove(); calcola()" class="text-red-400 ml-1">×</button>
            `;
            container.appendChild(div);
        }

        function calcola() {
            const tot = parseFloat(document.getElementById('inp-tot').value) || 0;
            let ele = 0;
            document.querySelectorAll('.val-elettr').forEach(i => ele += parseFloat(i.value) || 0);
            
            let uscCash = 0;
            document.querySelectorAll('#fornitori-list > div').forEach(div => {
                if(div.querySelector('.check-cash').checked) {
                    uscCash += parseFloat(div.querySelector('.val-usc').value) || 0;
                }
            });

            const teorico = tot - ele;
            const netto = teorico - uscCash;

            document.getElementById('res-elettr').innerText = `€ ${ele.toFixed(2)}`;
            document.getElementById('res-teor').innerText = `€ ${teorico.toFixed(2)}`;
            document.getElementById('res-cash-uscita').innerText = `€ ${uscCash.toFixed(2)}`;
            document.getElementById('res-netto').innerText = `€ ${netto.toFixed(2)}`;
        }

        function salvaTutto() {
            const data = document.getElementById('data-lavoro').value;
            const record = {
                data,
                totale: parseFloat(document.getElementById('inp-tot').value) || 0,
                pos: parseFloat(document.getElementById('inp-pos').value) || 0,
                sat: parseFloat(document.getElementById('inp-sat').value) || 0,
                del: parseFloat(document.getElementById('inp-del').value) || 0,
                tap: parseFloat(document.getElementById('inp-tap').value) || 0,
                usc_cash: parseFloat(document.getElementById('res-cash-uscita').innerText.replace('€ ',''))
            };
            database = database.filter(r => r.data !== data);
            database.push(record);
            localStorage.setItem('erjon_pro_db', JSON.stringify(database));
            alert("Giornata Salvata!");
        }

        function cercaGiorno() {
            const d = document.getElementById('search-date').value;
            const res = database.find(r => r.data === d);
            const div = document.getElementById('search-result');
            div.classList.remove('hidden');
            if(res) {
                div.innerHTML = `<strong>Data: ${res.data}</strong><br>Incasso: €${res.totale}<br>Elettronico: €${(res.pos+res.sat+res.del+res.tap).toFixed(2)}<br>Uscite Cash: €${res.usc_cash}`;
            } else {
                div.innerHTML = "Nessun dato trovato per questa data.";
            }
        }

        function updateStats() {
            const filter = document.getElementById('filter-month').value;
            let mTot = 0, mUsc = 0;
            database.forEach(r => {
                if(r.data.startsWith(filter)) {
                    mTot += r.totale;
                    mUsc += r.usc_cash;
                }
            });
            document.getElementById('stat-month').innerText = `€ ${mTot.toFixed(2)}`;
            document.getElementById('stat-usc').innerText = `€ ${mUsc.toFixed(2)}`;
        }

        function generaReportRagioniere() {
            const from = document.getElementById('p-from').value;
            const to = document.getElementById('p-to').value;
            const mode = document.getElementById('p-mode').value;
            let filtrati = database.filter(r => r.data >= from && r.data <= to).sort((a,b) => a.data.localeCompare(b.data));
            
            let h = `<div class="card text-xs">`;
            h += `<h2 class="font-bold text-center mb-4 uppercase">Prospetto Contabile dal ${from} al ${to}</h2>`;
            h += `<table class="w-full"><thead><tr class="border-b"><th>Data</th><th>Valore</th></tr></thead><tbody>`;
            filtrati.forEach(r => {
                let val = r.totale;
                if(mode === 'solo-ele') val = r.pos + r.sat + r.del + r.tap;
                h += `<tr class="border-b text-center"><td class="py-1">${r.data}</td><td class="py-1 font-bold">€ ${val.toFixed(2)}</td></tr>`;
            });
            h += `</tbody></table><button onclick="window.print()" class="btn-primary mt-4 no-print">STAMPA ORA</button></div>`;
            document.getElementById('area-stampa').innerHTML = h;
        }

        document.getElementById('data-lavoro').valueAsDate = new Date();
    </script>
</body>
</html>
